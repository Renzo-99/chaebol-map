# PRD (Product Requirements Document)

## ChaebolMap — 한국 대기업 그룹 소유지분도 시각화 플랫폼

---

## 1. 프로젝트 비전

### 1.1 핵심 아이덴티티

ChaebolMap은 한국 주요 대기업 그룹(재벌)의 **소유지분 구조를 인터랙티브하게 시각화**하는 웹 플랫폼입니다.

공정거래위원회(FTC)의 공식 소유지분도 데이터를 기반으로, 기존의 정적인 PDF/이미지 자료를 **현대적이고 직관적인 인터랙티브 그래프**로 재해석합니다.

### 1.2 컨셉

> **"공정위 데이터의 정확성 × 토스 디자인의 직관성"**

- **공정위(FTC) 배치 스타일**: 계층적 BFS 트리 레이아웃으로 소유 구조의 상하관계를 명확히 표현
- **토스(Toss) 디자인 언어**: 다크 테마 기반의 깔끔하고 현대적인 UI로 금융 데이터를 매력적으로 전달
- **실시간 주가 연동**: Yahoo Finance API를 통한 상장 계열사 주가 정보 자동 업데이트

### 1.3 목적

| 목적 | 설명 |
|------|------|
| **정보 접근성 향상** | 복잡한 재벌 소유구조를 누구나 쉽게 탐색하고 이해할 수 있게 함 |
| **투자 판단 지원** | 상장 계열사의 실시간 주가·시가총액과 지분관계를 통합 제공 |
| **구조 분석 도구** | 순환출자·교차출자 경로 추적, 지분율 필터링 등 전문 분석 기능 |
| **비교·벤치마크** | 29대 그룹의 규모·구조·상장 현황을 한눈에 비교 |

### 1.4 핵심 가치

- **정확성**: 공정위 공식 데이터(2025.5.1 기준, 발행주식총수 기준 지분율%)에 기반
- **직관성**: 복잡한 데이터를 시각적으로 명료하게 전달
- **실시간성**: 상장사 주가·시가총액 실시간 연동
- **접근성**: 별도 설치 없이 웹 브라우저에서 즉시 이용

---

## 2. 문제 정의

### 2.1 현재 문제점

| 문제 | 상세 |
|------|------|
| **정적 자료 한계** | 공정위 소유지분도는 PDF/이미지 형태로만 제공되어, 특정 회사나 경로를 추적하기 어려움 |
| **정보 분산** | 소유구조 데이터와 주가·시가총액·섹터 정보가 별도 출처에 흩어져 있어 통합 분석이 불편 |
| **복잡성** | 수십~수백 개 계열사 간 복잡한 지분관계를 평면 자료로는 파악하기 매우 어려움 |
| **업데이트 지연** | 기존 자료는 연 1회 업데이트되며, 주가 등 실시간 정보가 반영되지 않음 |
| **비교 불가** | 그룹 간 구조 비교, 규모 비교 등 크로스 분석이 사실상 불가능 |

### 2.2 타겟 사용자

| 사용자 유형 | 활용 시나리오 |
|------------|-------------|
| **개인 투자자** | 투자 대상 기업의 그룹 내 위치·지분구조 파악, 관계사 분석 |
| **금융 애널리스트** | 기업 가치평가 시 소유구조 참고, 지배구조 리스크 분석 |
| **기자·연구원** | 대기업 지배구조 기사·논문 작성 시 시각 자료 활용 |
| **일반 대중** | 한국 경제의 재벌 구조에 대한 이해 및 학습 |
| **학생** | 경영학·경제학 수업에서 기업 소유구조 학습 자료로 활용 |

---

## 3. 기술 스택

### 3.1 현재 구성

| 영역 | 기술 | 버전 |
|------|------|------|
| **Framework** | Next.js (App Router) | 16.1.6 |
| **Language** | TypeScript (strict mode) | 5.9.3 |
| **UI Runtime** | React | 19.2.3 |
| **UI Components** | shadcn/ui + Radix UI | - |
| **Styling** | Tailwind CSS | 4.0 |
| **Graph** | React Flow (@xyflow/react) | 12.10.1 |
| **State** | Zustand | 5.0.11 |
| **Charts** | Recharts | 3.7.0 |
| **Icons** | Lucide React | 0.575.0 |
| **Forms** | React Hook Form + Zod | 7.71.2 / 4.3.6 |
| **Theme** | next-themes | 0.4.6 |
| **Testing** | Vitest + Testing Library | 4.0.18 |
| **Deploy** | GitHub Pages (Static Export) | - |
| **Database** | Supabase (PostgreSQL) — 계획됨 | - |
| **Auth** | Supabase Auth — 계획됨 | - |

### 3.2 배포 구성

| 항목 | 값 |
|------|-----|
| **빌드 방식** | Static Export (`output: "export"`) |
| **Base Path** | `/chaebol-map` |
| **호스팅** | GitHub Pages (gh-pages 브랜치) |
| **URL** | https://renzo-99.github.io/chaebol-map/ |
| **이미지** | Unoptimized (정적 빌드) |

---

## 4. 데이터

### 4.1 데이터 출처

- **공정거래위원회 대기업집단 소유지분도** (2025.5.1 기준)
- 발행주식총수 기준 지분율(%)
- ★ = 상장회사

### 4.2 지원 그룹 (29대 그룹)

| # | 그룹 | 동일인(총수) | 주요 업종 |
|---|------|-------------|----------|
| 1 | 삼성 | 이재용 | 전자/바이오/금융 |
| 2 | SK(에스케이) | 최태원 | 에너지/ICT/반도체 |
| 3 | 현대자동차 | 정의선 | 자동차/건설/금융 |
| 4 | LG(엘지) | 구광모 | 화학/전자/에너지 |
| 5 | 롯데 | 신동빈 | 유통/화학/식품 |
| 6 | 포스코 | 포스코홀딩스(주) | 철강/소재/에너지 |
| 7 | 한화 | 김승연 | 방산/에너지/우주 |
| 8 | HD현대 | 정몽준 | 조선/해양/중공업 |
| 9 | GS | 허창수 | 에너지/유통/건설 |
| 10 | 신세계 | 이명희 | 유통/면세/호텔 |
| 11 | 한진 | 조원태 | 항공/물류/터미널 |
| 12 | KT | KT(자기주식) | 통신/미디어 |
| 13 | CJ | 이재현 | 식품/엔터/물류 |
| 14 | LS | 구자은 | 전선/에너지/전력 |
| 15 | 카카오 | 김범수 | IT플랫폼/엔터/금융 |
| 16 | 두산 | 박정원 | 인프라/에너지/로보틱스 |
| 17 | DL | 이준용 | 건설/화학/에너지 |
| 18 | 중흥건설 | 정창선 | 건설/토건 |
| 19 | 셀트리온 | 서정진 | 바이오시밀러/제약 |
| 20 | 네이버 | 최수연 | IT플랫폼/웹툰/커머스 |
| 21 | 미래에셋 | 박현주 | 증권/자산운용 |
| 22 | 쿠팡 | 김범석 | 이커머스/물류 |
| 23 | 한국앤컴퍼니 | 조현범 | 타이어/부품 |
| 24 | 부영 | 이중근 | 건설/주택 |
| 25 | 영풍 | 장형진 | 비철금속/아연 |
| 26 | 하림 | 김홍국 | 식품/해운/농업 |
| 27 | 효성 | 조현준 | 섬유/중공업/화학 |
| 28 | SM(삼라마이다스) | 우오현 | 해운/철강/건설 |
| 29 | HDC | 정몽규 | 건설/개발/호텔 |

### 4.3 데이터 모델

```typescript
// 대기업 그룹
interface ConglomerateGroup {
  id: string;
  name: string;              // 삼성, SK, 현대자동차 ...
  slug: string;              // samsung, sk, hyundai ...
  controllerName: string;    // 이재용, 최태원 ...
  description: string;
  dataDate: string;          // 2025.5.1
  totalCompanies: number;
  listedCompanies: number;
}

// 계열사
interface Company {
  id: string;
  groupId: string;
  name: string;
  isListed: boolean;         // 상장 여부 (★)
  isHolding: boolean;        // 지주회사 여부
  isController: boolean;     // 동일인 노드 여부
  category: string;          // 업종
  stockCode?: string;        // 종목코드 (005930 등)
  stockPrice?: number;       // 현재 주가
  priceChange?: number;      // 전일 대비 변동액
  priceChangePercent?: number; // 전일 대비 변동률(%)
  marketCap?: number;        // 시가총액 (억원)
  sector?: string;           // 섹터
}

// 소유 관계 (회사 → 회사)
interface OwnershipRelation {
  id: string;
  groupId: string;
  fromCompanyId: string;     // 출자자
  toCompanyId: string;       // 피출자자
  ownershipPct: number;      // 지분율 (0~100)
}

// 동일인 직접 보유
interface ControllerHolding {
  groupId: string;
  companyId: string;
  ownershipPct: number;      // 동일인의 직접 지분율
}

// 통합 그룹 데이터
interface GroupData {
  group: ConglomerateGroup;
  companies: Company[];
  relations: OwnershipRelation[];
  controllerHoldings: ControllerHolding[];
}
```

### 4.4 데이터 저장 방식

| 현재 | 향후 (Phase 2) |
|------|---------------|
| JSON 파일 (`src/data/*.json`) — 29개 그룹 각각 | Supabase PostgreSQL + RLS |
| 정적 import (`lib/data.ts`) | Next.js Route Handler API |
| 빌드 타임에 모든 데이터 포함 | 서버사이드 데이터 페칭 |

---

## 5. 핵심 기능

### 5.1 인터랙티브 소유지분도 (메인 기능) ✅ 구현 완료

#### 그래프 시각화
- **BFS 트리 레이아웃**: 동일인(총수)을 루트로 하는 계층적 배치
  - Level 0: 동일인(총수)
  - Level 1: 동일인 직접 보유 계열사
  - Level 2+: 소유 관계에 따른 하위 계열사
- **적응형 스케일링**: 노드 수에 따라 자동 간격 조정 (20개 이하 ~ 50개 초과)
- **노드 타입별 차별화**:
  - 동일인(총수): 앰버 그래디언트, 라운드 박스
  - 상장회사(★): 블루 좌측 보더, 주가/등락률 표시
  - 지주회사: 그린 좌측 보더, 다크그린 배경
  - 비상장 일반: 미니멀한 다크 박스
- **엣지 스타일링**: 지분율에 따른 색상·두께·점선 차별화
  - 50%+: 앰버, 2.5px (지배적 지분)
  - 20%+: 블루, 1.5px (주요 지분)
  - 5%+: 그레이, 1px (중요 지분)
  - <5%: 점선, 1px (소수 지분)
- **화살표 마커**: 모든 엣지에 방향 화살표 표시

#### 인터랙션
- 줌 인/아웃 (마우스 휠, 컨트롤 버튼)
- 패닝 (드래그)
- 노드 클릭 → 회사 상세 정보 사이드 패널
- 미니맵 (우측 하단)
- 전체 보기 맞춤 (fitView)

#### 필터링
- **지분율 임계값 슬라이더** (0~50%): 설정값 미만의 엣지 숨김
- 필터 적용 시 관련 노드만 표시 (고립 노드 자동 제거)

#### 범례
- 노드 타입별 범례 (동일인, 상장회사, 지주회사, 비상장)
- 엣지 스타일별 범례 (50%+, 20%+, <5%)
- 글래스모피즘 오버레이 디자인

### 5.2 회사 상세 정보 패널 ✅ 구현 완료

- **슬라이드인 사이드 패널** (우측, 380px)
- 회사명, 상장/비상장 배지, 업종 배지, 종목코드
- **주가 정보** (상장사): 현재가, 전일 대비 변동, 변동률, 시가총액, 섹터
- **주요 주주**: 동일인 및 그룹 내 출자 회사 목록 (지분율 내림차순)
- **출자 현황**: 해당 회사가 보유한 타 계열사 지분 목록 (지분율 내림차순)

### 5.3 실시간 주가 연동 ✅ 구현 완료

- **Yahoo Finance API** 연동 (KRX/KOSDAQ)
- **CORS 프록시**: allorigins.win → corsproxy.io 순차 시도
- **배치 조회**: 5개 종목씩 동시 요청
- **캐시**: sessionStorage 기반 5분 TTL 캐시
- **상태 표시**: Live / 로딩중 / 저장된 데이터 인디케이터

### 5.4 대시보드 ✅ 구현 완료

- 전체 통계 카드 (그룹 수, 총 계열사, 상장사, 추적 종목)
- 시가총액 상위 5개 그룹
- 등락률 상위/하위 종목
- 전체 그룹 카드 그리드 (클릭 → 지분도 페이지)

### 5.5 그룹 비교 ✅ 구현 완료

- 29개 그룹 비교 테이블
- 비교 항목: 그룹명, 동일인, 계열사 수, 상장사 수, 지분관계 수, 합산 시가총액, 최대 계열사
- 시가총액 내림차순 정렬

### 5.6 랜딩 페이지 ✅ 구현 완료

- 히어로 섹션 (프로젝트 소개, CTA)
- 전체 통계 (29그룹, 총 계열사, 상장사)
- 그룹 카드 그리드 (상위 3종목 주가 변동률 포함)
- 주요 기능 소개 섹션

---

## 6. 페이지 구조 (사이트맵)

### 현재 구현

```
/                            → 랜딩 페이지 (히어로 + 그룹 카드)
/dashboard                   → 대시보드 (통계 + 그룹 목록)
/groups                      → 전체 그룹 카드 목록
/groups/[slug]               → 그룹 소유지분도 (인터랙티브 그래프)
/compare                     → 29개 그룹 비교 테이블
```

### 향후 계획

```
/login                       → 로그인
/signup                      → 회원가입
/groups/[slug]/companies     → 그룹 계열사 목록 (테이블 뷰)
/companies/[id]              → 회사 상세 정보
/search                      → 통합 검색
/settings                    → 설정
/settings/profile            → 프로필 설정
/settings/bookmarks          → 북마크 관리
```

---

## 7. 프로젝트 구조

```
src/
├── app/                          # Next.js App Router
│   ├── (auth)/                   # 인증 라우트 (계획)
│   ├── (main)/                   # 메인 레이아웃 (Navbar 포함)
│   │   ├── dashboard/page.tsx    # 대시보드
│   │   ├── groups/
│   │   │   ├── page.tsx          # 그룹 목록
│   │   │   └── [slug]/
│   │   │       ├── page.tsx      # 그룹 상세 (SSR)
│   │   │       └── GroupDetailClient.tsx  # 클라이언트 (그래프+주가)
│   │   ├── compare/page.tsx      # 그룹 비교
│   │   └── layout.tsx            # 메인 레이아웃
│   ├── layout.tsx                # 루트 레이아웃
│   ├── page.tsx                  # 랜딩 페이지
│   └── globals.css               # 전역 스타일 + CSS 변수
│
├── components/
│   ├── graph/                    # React Flow 그래프 컴포넌트
│   │   ├── OwnershipGraph.tsx    # 메인 그래프 (필터, 범례, ReactFlow)
│   │   ├── CompanyNode.tsx       # 커스텀 노드 렌더러
│   │   ├── OwnershipEdge.tsx     # 커스텀 엣지 렌더러
│   │   └── CompanyDetailPanel.tsx # 회사 상세 사이드 패널
│   ├── layout/
│   │   └── Navbar.tsx            # 상단 네비게이션
│   ├── shared/
│   │   ├── GroupCard.tsx         # 그룹 카드 (재사용)
│   │   └── StockPriceChip.tsx    # 주가 표시 칩
│   └── ui/                      # shadcn/ui 컴포넌트
│       ├── badge.tsx
│       ├── button.tsx
│       └── card.tsx
│
├── lib/
│   ├── data.ts                  # JSON 데이터 로더 (29개 그룹)
│   ├── graph-layout.ts          # BFS 트리 레이아웃 알고리즘
│   ├── constants.ts             # 그룹 아이콘 매핑
│   └── utils.ts                 # 포매터 유틸리티
│
├── hooks/
│   └── useLiveStockPrices.ts    # Yahoo Finance 실시간 주가 훅
│
├── stores/                      # Zustand 스토어 (계획)
│
├── types/
│   └── index.ts                 # 전체 TypeScript 인터페이스
│
└── data/                        # JSON 시드 데이터 (29개 파일)
    ├── samsung.json
    ├── sk.json
    ├── hyundai.json
    └── ... (총 29개)
```

---

## 8. 비기능 요구사항

| 항목 | 요구사항 |
|------|---------|
| **성능** | 수백 개 노드/엣지를 60fps로 렌더링 (React Flow 가상화) |
| **적응형 스케일링** | 노드 수에 따라 자동 레이아웃 조정 (20~50+ 노드) |
| **반응형** | 데스크탑 최적화, 태블릿 지원, 모바일 제한적 지원 |
| **접근성** | WCAG 2.1 AA 기준, 시맨틱 HTML, 키보드 네비게이션 |
| **보안** | HTTPS, (향후) Supabase RLS 적용 |
| **SEO** | 랜딩 페이지 SSR, 그룹별 메타 태그 |
| **캐시** | 주가 데이터 5분 sessionStorage 캐시 |
| **빌드** | 36페이지 정적 빌드, GitHub Pages 자동 배포 |
| **테스트** | Vitest 44개 테스트 통과, 43%+ 커버리지 |

---

## 9. 마일스톤

### Phase 1: MVP ✅ 완료

- [x] 29대 그룹 소유지분도 데이터 수집 및 JSON 구조화
- [x] BFS 트리 기반 인터랙티브 그래프 시각화
- [x] FTC 배치 스타일 + Toss 다크 디자인 시스템
- [x] 노드 타입별 시각적 차별화 (총수/상장/지주/비상장)
- [x] 엣지 지분율별 스타일링 (색상, 두께, 점선)
- [x] 회사 상세 정보 사이드 패널
- [x] 지분율 필터 슬라이더
- [x] 실시간 주가 연동 (Yahoo Finance)
- [x] 대시보드, 그룹 목록, 비교 페이지
- [x] 랜딩 페이지
- [x] 81개 상장 종목 주가 데이터 매핑
- [x] GitHub Pages 배포
- [x] 테스트 인프라 구축 (44개 테스트)

### Phase 2: 사용자 기능 (계획)

- [ ] Supabase 인증 (이메일/비밀번호, Google OAuth)
- [ ] 사용자 북마크 (관심 회사/그룹)
- [ ] 통합 검색 (Cmd+K 커맨드 팔레트)
- [ ] 회사 상세 페이지 (`/companies/[id]`)
- [ ] 그룹 계열사 테이블 뷰 (`/groups/[slug]/companies`)
- [ ] 노드 호버 시 연결된 경로 하이라이트
- [ ] 순환출자 경로 자동 감지 및 시각화
- [ ] 업종별 필터링 (금융, IT, 제조 등)
- [ ] 상장사/비상장사 토글 필터

### Phase 3: 고급 기능 (계획)

- [ ] 연도별 변화 히스토리 (타임라인)
- [ ] 그룹 간 교차 소유 분석
- [ ] 맞춤형 리포트 생성 및 PDF 내보내기
- [ ] 외부 API 공개
- [ ] Recharts 기반 통계 대시보드 강화
- [ ] 실시간 주가 차트 (일봉/주봉)
- [ ] 커스텀 메모/노트 기능
- [ ] 다크/라이트 모드 전환

---

## 10. 시각화 설계

### 10.1 노드 타입

| 타입 | 스타일 | 색상 | 내부 요소 |
|------|--------|------|----------|
| 동일인(총수) | 라운드 박스 (12px) | 앰버 그래디언트 (#F59E0B→#D97706) | "동일인" 라벨 + 이름 |
| 상장회사(★) | 박스 (10px) + 블루 좌측 보더 | #212830 배경, #3182F6 보더 | ★ + 회사명 + 주가 + 등락률 |
| 지주회사 | 박스 (10px) + 그린 좌측 보더 | #1C2E24 배경, #22C55E 보더 | 회사명 + "지주" 배지 |
| 비상장 일반 | 박스 (10px) | #212830 배경, #2C3542 보더 | 회사명 |

### 10.2 엣지 스타일

| 지분율 범위 | 색상 | 두께 | 스타일 |
|------------|------|------|--------|
| 50% 이상 | #F59E0B (앰버) | 2.5px | 실선 |
| 20~50% | #3182F6 (블루) | 1.5px | 실선 |
| 5~20% | #64748B (슬레이트) | 1px | 실선 |
| 5% 미만 | #4B5563 (그레이) | 1px | 점선 (4,4) |
| 동일인 직접 | #F59E0B (앰버) | 2px | 실선 |

### 10.3 레이아웃 알고리즘

```
1. BFS 기반 레벨 할당
   - 동일인 → Level 0
   - 동일인 직접 보유 → Level 1 (지분율 내림차순 정렬)
   - BFS 탐색으로 Level 2, 3, ... 할당
   - 고립 노드: 유형별 기본 레벨 (지주=1, 상장=2, 비상장=3)

2. 적응형 스케일링
   - 50+ 노드: scale 0.65, perRow 12
   - 35+ 노드: scale 0.75, perRow 10
   - 20+ 노드: scale 0.85, perRow 8
   - 20이하: scale 1.0, perRow 6

3. 배치 계산
   - 수평 간격: 175px × scale
   - 수직 간격: 110px × scale
   - 레벨 내 중앙 정렬
   - 레벨 내 정렬: 지주 > 상장(시총순) > 비상장
```

---

## 11. 주요 명령어

```bash
npm run dev          # 개발 서버 (localhost:3000)
npm run build        # 프로덕션 빌드 (정적 내보내기)
npm run lint         # ESLint 실행
npm run test         # Vitest 테스트 실행
npm run test:watch   # 테스트 워치 모드
npm run test:coverage # 테스트 커버리지 리포트
```

---

## 12. 참고 문서

- **DESIGN.md** — UI/UX 디자인 가이드 (Toss 디자인 시스템 기반)
- **CLAUDE.md** — 프로젝트 개발 가이드라인
- **공정거래위원회** — 대기업집단 소유지분도 원본 데이터
